<% content_for :title, "Documentos" %>

<div class="w-full">
  <% if notice.present? %>
    <p class="py-2 px-3 bg-green-50 mb-5 text-green-500 font-medium rounded-md inline-block" id="notice"><%= notice %></p>
  <% end %>

  <div class="flex justify-between items-center mb-5">
    <h1 class="mb-10 font-bold text-4xl text-gray-800 dark:text-white">Gerar Documentos</h1>
  </div>

  <div class="bg-white dark:bg-gray-800 shadow-md rounded-md p-6">
<%= form_with url: generate_document_path, method: :post, data: { turbo: false }, html: { target: '_blank' } do %>
      <div class="mb-4">
        <%= label_tag :classroom_id, "Turma", class: "block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300" %>
        <%= select_tag :classroom_id, options_from_collection_for_select(@classrooms, :id, :name), prompt: "Selecione uma turma", class: "form-select w-full px-4 py-2 border rounded-md dark:bg-gray-700 dark:text-white dark:border-gray-600" %>
      </div>

      <div class="mb-4">
        <%= label_tag :document_type, "Tipo de Documento", class: "block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300" %>
        <%= select_tag :document_type, options_for_select([["Folha de Frequência", "frequencia"], ["Folha de Notas", "notas"]]), prompt: "Escolha o tipo", class: "form-select w-full px-4 py-2 border rounded-md dark:bg-gray-700 dark:text-white dark:border-gray-600" %>
      </div>

      <div class="mb-4">
        <%= label_tag :professor, "Nome do Professor(a)", class: "block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300" %>
        <%= text_field_tag :professor, nil, class: "form-input w-full px-4 py-2 border rounded-md dark:bg-gray-700 dark:text-white dark:border-gray-600" %>
      </div>

      <div class="mb-4" id="extra-field"></div>

      <div>
        <%= submit_tag "Gerar PDF", class: "rounded-md px-4 py-2.5 bg-blue-600 hover:bg-blue-500 text-white font-medium" %>
      </div>
    <% end %>
  </div>
</div>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const tipoSelect = document.querySelector('[name="document_type"]');
    const extraField = document.getElementById('extra-field');

    tipoSelect.addEventListener('change', function () {
      const tipo = this.value;
      let html = '';

      if (tipo === 'frequencia') {
        // --- INÍCIO DO BLOCO DE CÓDIGO ALTERADO ---
        html = `
          <div class="mb-4">
            <label class="block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300">Mês</label>
            <select name="month" class="form-select w-full px-4 py-2 border rounded-md dark:bg-gray-700 dark:text-white dark:border-gray-600">
              <option value="">Selecione um mês</option>
              <option value="Janeiro">Janeiro</option>
              <option value="Fevereiro">Fevereiro</option>
              <option value="Março">Março</option>
              <option value="Abril">Abril</option>
              <option value="Maio">Maio</option>
              <option value="Junho">Junho</option>
              <option value="Julho">Julho</option>
              <option value="Agosto">Agosto</option>
              <option value="Setembro">Setembro</option>
              <option value="Outubro">Outubro</option>
              <option value="Novembro">Novembro</option>
              <option value="Dezembro">Dezembro</option>
            </select>
          </div>
          <div>
            <label class="block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300">Disciplina</label>
            <input type="text" name="discipline" class="form-input w-full px-4 py-2 border rounded-md dark:bg-gray-700 dark:text-white dark:border-gray-600" />
          </div>
        `;
        // --- FIM DO BLOCO DE CÓDIGO ALTERADO ---
      } else if (tipo === 'notas') {
        // --- INÍCIO DO BLOCO DE CÓDIGO SUGERIDO ---
        html = `
          <div class="mb-4">
            <label class="block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300">Bimestre</label>
            <select name="bimestre" class="form-select w-full px-4 py-2 border rounded-md dark:bg-gray-700 dark:text-white dark:border-gray-600">
              <option value="">Selecione o bimestre</option>
              <option value="1º Bimestre">1º Bimestre</option>
              <option value="2º Bimestre">2º Bimestre</option>
              <option value="3º Bimestre">3º Bimestre</option>
              <option value="4º Bimestre">4º Bimestre</option>
            </select>
          </div>
          <div>
            <label class="block mb-1 text-sm font-medium text-gray-700 dark:text-gray-300">Disciplina</label>
            <input type="text" name="discipline" class="form-input w-full px-4 py-2 border rounded-md dark:bg-gray-700 dark:text-white dark:border-gray-600" />
          </div>
        `;
        // --- FIM DO BLOCO DE CÓDIGO SUGERIDO ---
      }

      extraField.innerHTML = html;
    });
  });
</script>